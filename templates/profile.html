<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/static/profile_{{ session.get('theme', 'default') }}.css">
</head>
<body data-theme="{{ session.get('theme', 'default') }}">
    {% include 'sidebar.html' %}
    
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Post</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="editContent" rows="4" placeholder="Edit your post content..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="save-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Delete Post</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this post? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn">Cancel</button>
                <button class="delete-btn">Delete Post</button>
            </div>
        </div>
    </div>

    <div class="home-container">
        <h1>Your Profile</h1>
        
        <div class="profile-section">
            <div class="profile-picture">
                <img 
                    src="{{ url_for('static', filename='uploads/' + user['profile_picture'] if user['profile_picture'] else '/uploads/d1.jpg') }}" 
                    alt="Profile Picture" 
                    class="profile-pic"
                >
            </div>

            <div class="username">
                <p><strong>{{ user['username'] }}</strong></p>
            </div><br>
            <div class="user-bio">
                <p><strong>Bio: </strong>{{ user['bio'] if user['bio'] else 'No bio available. Add one in Edit Profile!' }}</p>
            </div>
            <br>
            
            <div class="follow-stats">
                <p><strong>Following:</strong> {{ following_count or 0 }}</p>
                <p><strong>Followers:</strong> {{ followers_count or 0 }}</p><br>
            </div>
            
            <a href="{{ url_for('edit_profile') }}" class="edit-profile-btn">Edit Profile</a>
           
            <div class="user-posts">
                <h2>Your Posts</h2>
                {% if posts %}
                    {% for post in posts %}
                        <div class="post" id="post-{{ post[0] }}">
                            <div class="post-info">
                                <div class="post-header">
                                    <div id="p" class="profile-picture">
                                        <img 
                                            src="{{ url_for('static', filename='uploads/' + user['profile_picture'] if user['profile_picture'] else '/uploads/d1.jpg') }}" 
                                            alt="Profile Picture" 
                                            class="profile-pic"
                                        >
                                    </div>
                                    
                                    <div class="username-caption">
                                        <span class="username">{{ post[1] }}</span>
                                        <div id="h">
                                            <p id="para">You posted</p>
                                        </div>
                                    </div>
                                    <div class="menu-icon">
                                        <i class="fas fa-ellipsis-v"></i>
                                        <div class="dropdown-menu">
                                            <button class="edit-post-btn" data-post-id="{{ post[0] }}">‚úèÔ∏è Edit Post</button>
                                            <button class="delete-post-btn" data-post-id="{{ post[0] }}">üóëÔ∏è Delete Post</button>
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="username-caption"> 
                                    <span class="caption" id="post-content-{{ post[0] }}">{{ post[2] }}</span>
                                </div><br>
                                {% if post[3] and post[3] != 'None' %}
                                    <img 
                                        src="{{ url_for('static', filename='uploads/' + post[3]) }}" 
                                        alt="Post Image" 
                                        class="post-image"
                                    >
                                {% endif %}
                                {% if post[4] and post[4] != 'None' %}
                                    <video controls class="post-video">
                                        <source src="{{ url_for('static', filename='uploads/' + post[4]) }}" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                {% endif %}
                            </div>

                            <div class="post-footer">
                                <div class="post-actions">
                                    <button class="like-button" data-post-id="{{ post[0] }}" data-liked="{{ post[7] }}">
                                        <i class="heart-icon {{ 'fas' if post[7] else 'far' }} fa-heart"></i>
                                        <span class="like-count">{{ post[6] }}</span>
                                    </button>
                                    <button class="comment-button" data-post-id="{{ post[0] }}">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                </div>
                                <p class="timestamp">{{ post[8] }}</p>
                            </div>
    
                            <div class="comment-section" id="comment-section-{{ post[0] }}" style="display: none;">
                                <div class="add-comment">
                                    <textarea class="comment-input" placeholder="Add a comment..."></textarea>
                                    <button class="post-comment-btn" data-post-id="{{ post[0] }}">Post</button>
                                </div>
                                <div class="comments-list">
                                    <!-- Comments will be loaded here dynamically -->
                                </div>
                                
                            </div>

                        </div>
                    {% endfor %}
                {% else %}
                    <p>No posts available.</p>
                {% endif %}
            </div>
        </div>
    </div>

    

    <script src="/static/profile.js"></script>
</body>
</html>